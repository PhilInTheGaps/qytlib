name: CI
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      COVERALLS_REPO_TOKEN: ${{ secrets.COVERALLS_TOKEN }}
    steps:
      - name: Get Qt
        uses: jurplel/install-qt-action@v2
        
      - name: Install other dependencies
        run: sudo apt-get install cmake libtinyxml2-dev
        
      - name: Checkout Git
        uses: actions/checkout@v2
        with:
          submodules: "recursive"
      
      - name: Setup build directory
        run: mkdir build
      
      - name: Run CMake
        run: cd build && cmake .. -DCMAKE_BUILD_TYPE=Debug -G "Unix Makefiles" -DCOVERALLS=ON
      
      - name: Make
        run: cd build && make -j$(nproc)
      
      - name: Generate Coverage
        run: cd build && make coveralls
